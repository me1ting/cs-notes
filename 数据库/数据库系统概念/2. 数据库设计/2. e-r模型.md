# 实体联系模型

实体-联系(entity-relationship,E-R)数据模型，是设计数据库最常采用的高层数据模型。

## 实体

`实体`是可以区别的事物或对象，可以出自于现实世界，也可以是完全抽象的。类似OOP编程中的`对象`概念。

`实体集`是具有相同类型的实体的集合。

实体由一组`属性`来表示，每个属性都有一个`值`。

每个实体都应该有一个唯一标识符`ID`来唯一标志该实体。

## 联系

`联系`是指实体间的相互关联。`联系集`是相同类型联系的集合。

实体在联系中扮演的功能称为实体的`角色`。同样的实体集可能以不同的角色多次参与到一个联系集中。

>角色是通过联系的属性来表示的。

我们用实体的`有序对`（如`(c1,c2)`）来建模联系集，除此外，联系也可以拥有自己的`描述性属性`。如果联系集的的每个联系实例可以由实体唯一标志，那么就不需要使用描述性属性，否则必须使用描述性属性。

相同的实体集可以参与到多个联系集中。

一个联系集可以由多于2个实体集参与，参与联系集的实体集的数目称为联系集的`度`。特别的，度数为2的联系集称为`二元联系集`，否则称为`多元联系集`。

## 属性

属性的可取值的集合称为`域`。

可以使用如下格式描述实体：`{(ID,123),(name,zhangsan),{dept_name,生物}}`。

## 复合属性

在E-R模型中，属性可以是单元，也可以是由多元多多层次组成的树。

比如：

```
地址
   国家
   城市
   街道
	   街道名称
	   街道号
```

## 多值属性

属性通常是单个值，但也可以是多个。

比如，一个人的电话号码可以有0个，1个，或者多个。使用花括号来描述多值属性：`{phone_number}`。

## 派生属性

由存储的属性通过计算得出的属性称为`派生属性`，比如一个人的年龄通过当前日期与出生日期做差得出。

## 空值

`null`表示属性值不存在或者属性值未知。

# 约束

这里讨论E-R模型中的约束相关概念。

## 映射基数

术语`映射基数`用于描述一个实体通过一个联系集能够关联的实体的数量。

映射基数主要用来描述二元联系集中，虽然它也能用于多元联系集。

对于实体集A、B构成的联系集，映射基数存在以下情况：

- 一对一
- 一对多
- 多对一
- 多对多

## 参与约束

如果实体集中的每一个实体都参与到联系集中，这种参与关系称为`全部的`，否则是`部分的`。

## 码/键

实体应当是互异的，使用属性来区分，因此不允许存在所有属性值都相同的实体。

对于联系集，我们使用参与该联系集的所有实体集的主码作为该联系集的主码：$primary-key(E_1)Uprimary-key(E_2)Uprimary-key(E_3)...$。

对于二元联系集，其主码比较特殊，依赖于其映射基数：

- 如果是一对一关系，任意一个主体集的主码均可作为该联系集的主码
- 如果是一对多关系或多对一关系，以“一”所在主体集的主码作为该联系集的主码
- 如果是多对多关系，才使用两个主体集的并集作为该联系集的主码

对于多元联系集，如果存在基数限制，可以将上述结果进行推广。

# 从实体集中删除冗余属性

实体可能具有冗余属性，在使用E-R模型来表示实体时，我们需要删除冗余属性。

那么属性保留在哪一个实体中呢？看重要程度：

- 主键优先

# 设计问题

## 用实体集还是属性

比如电话号码是用属性还是实体集合来表示，属性更加简单，实体集更具有扩展性、维护性。

实际上这取决于设计者对于需求的把控。

## 用实体集还是联系集

比如，学生选课，是用`takes`联系集表示，还是用`registration`实体集表示。

同样，者取决于设计者对于需求的把控。

## 联系属性的位置

在一对多或者一对一的联系集中，联系属性可以放在联系集中，也可以放在后者中。

实际上这取决于设计者对于需求的把控。