# 基本概念
`认证`：消息认证是解决“消息确实来自正确的发送者”这个问题。

`消息认证码（MAC）`：使用共享密钥混合消息得到消息认证码来认证发送方

其使用模式为：

- Alice发送消息和MAC
- Bob接收消息，计算MAC，对比接收到的MAC

# 密钥配送问题
MAC存在对称密码同样存在的密钥配送问题，解决办法是使用公钥密码、DH密钥交换、密钥配送中心...

# 应用场景

## TLS
TLS使用到了消息认证码。

# 计算消息认证码的算法
## 单向散列函数
`HMAC`: 使用单向散列函数计算得到的MAC。

## 分组密码
CBC模式计算得到的最后一个密文分组依赖于所有明文分组，其可以作为消息认证码。

# HMAC 详解
HMAC是使用单向散列函数来构造消息认证码的一种标准化方法（RFC2104）。

作为一种方法，其支持任何散列函数，如HMAC-SHA256，HMAC-SHA2-256...

HMAC将密钥消息经过一系列步骤运算后，计算得到MAC。

# 消息认证码的攻击

## 重放攻击
`重放攻击`：攻击者记录消息和MAC，并多次发送给接收者。

重放的攻击的解决办法是：

- 序号：计算MAC时附带序号
- 时间戳：将重放攻击的时间间隙缩短，该方法依赖于发送者和接收者之间的时钟同步
- nonce：每次通信前，接收者向发送者发送一个一次性的随机数（称为为nonce），发送者需要消息中包含这个数从而参与MAC计算

## 密钥推测攻击
利用消息和MAC值推算密钥。

# 消息认证码无法解决的问题
## 对第三方证明
由于密钥是通信双方共享的，接收者无法向第三方证明消息确实是由发送方所发，因为接收者也可以伪造。

## 防止否认
`否认`：发送者否认是自己所发的消息

和前者是一回事，只不过目标对象不同而已，因此问题不同。